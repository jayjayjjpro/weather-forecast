# build/install deps
FROM node:22-bookworm-slim AS deps
WORKDIR /app
ENV NODE_ENV=production
COPY package*.json ./
RUN npm ci --omit=dev --omit=optional
COPY . .

# minimal runtime
FROM gcr.io/distroless/nodejs22-debian12
WORKDIR /app
ENV NODE_ENV=production
ENV PORT=3000
COPY --from=deps /app /app
EXPOSE 3000
USER nonroot
CMD ["server.js"]
